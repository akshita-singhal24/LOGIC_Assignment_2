<!DOCTYPE html>
<html>
<head>
  <title>Dafny Verification Report</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin: 32px; background:#fcfcfc; }
    h1 { font-size: 2.2em; margin-bottom:0.2em;}
    h2 { margin-top:2em; font-size:1.2em; color:#223a7c;}
    h3 { margin-bottom:6px; margin-top:18px; font-size:1em; color:#2c2c2c;}
    .team { font-size:1.1em; margin-bottom:25px;}
    .team span { display:inline-block; width:220px;}
    pre { background: #f8f8f8; border-radius: 5px; padding: 12px 16px; font-size:15px; font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace; white-space:pre-wrap; margin-bottom:10px;}
    .output { background: #f2f2f2; border-left:5px solid #223a7c; padding:9px 18px; margin:8px 0 16px 0;}
    hr { border:none; border-top:2px solid #e2e2e2; margin:34px 0;}
    .contract-section { margin-bottom: 20px;}
    .contract-section b { font-weight:600; }
    ul { margin-top:6px; margin-bottom: 12px;}
    li { margin-bottom:5px;}
    .fail { background: #fff3f3; border-left:5px solid #bd2424; padding:9px 18px; margin:8px 0 16px 0;}
  </style>
</head>
<body>

<h1>Dafny Verification Report – Task 5: Verification and Error Demonstration</h1>
<div class="team">
  <b>Team Members:</b><br>
  <span>Akshita Singhal</span> | 2023B4A70712H<br>
  <span>Kritika Bhandari</span> | 2023B3A71253H<br>
  <span>Rujuta Deshmukh</span> | 2023B5A70952H<br>
  <span>Gunika Gupta</span> | 2023B4A70757H<br>
</div>
<hr>

<!-- ======================== -->
<h2>Task 1 – Absolute Value Function</h2>
<b>Verified Correct Code</b>
<pre>
method Abs(x: int) returns (x': int)
  ensures x' >= 0
  ensures (x >= 0 ==> x' == x) && (x < 0 ==> x' == -x)
{
  if x < 0 {
    x' := -x;
  } else {
    x' := x;
  }
}
</pre>
<div class="contract-section">
  <b>Postconditions:</b>
  <ul>
    <li><code>x' >= 0</code>: Result is always non-negative.</li>
    <li><code>x' == abs(x)</code>: Output matches the absolute value function.</li>
  </ul>
</div>
<b>Sample Output</b>
<div class="output">
Abs(5) = 5<br>
Abs(-12) = 12
</div>
<b>Error Demonstration (Weakened Specification)</b>
<pre>
method Abs(x: int) returns (y: int)
  ensures y >= 0
{
  y := 0;
}

method Main() {
  var v := Abs(3);
  assert v == 3; // Verification fails
}
</pre>
<div class="fail">
<b>Dafny output:</b><br>
Error: assertion might not hold
</div>
<div class="contract-section">
  <b>Discussion:</b> Omitting the full postcondition allows incorrect outputs to pass as non-negative. The assertion fails, showing why full correctness is needed.
</div>
<hr>

<!-- ======================== -->
<h2>Task 2 – First Negative in Array</h2>
<b>Verified Correct Code</b>
<pre>
method FindFirstNegative(a: array<int>) returns (index: int)
  requires a != null
  ensures index >= 0 ==> 0 <= index < a.Length && a[index] < 0
  ensures index >= 0 ==> (forall k :: 0 <= k < index ==> a[k] >= 0)
  ensures index < 0 ==> index == -1 && (forall k :: 0 <= k < a.Length ==> a[k] >= 0)
{
  var i := 0;
  while i < a.Length
    invariant 0 <= i <= a.Length
    invariant forall k :: 0 <= k < i ==> a[k] >= 0
    decreases a.Length - i
  {
    if a[i] < 0 {
      return i;
    }
    i := i + 1;
  }
  return -1;
}
</pre>
<div class="contract-section">
  <b>Loop Invariants:</b>
  <ul>
    <li><code>0 <= i <= a.Length</code>: Index in bounds.</li>
    <li><code>forall k :: 0 <= k < i ==> a[k] >= 0</code>: Elements checked so far are non-negative.</li>
  </ul>
</div>
<b>Sample Output</b>
<div class="output">
Array 1: First negative is at index: 2<br>
Array 2: First negative is at index: -1
</div>
<b>Error Demonstration (Omitted Invariant)</b>
<pre>
method FindFirstNegative(a: array<int>) returns (index: int)
  requires a != null
  ensures index >= 0 ==> 0 <= index < a.Length && a[index] < 0
  ensures index >= 0 ==> (forall k :: 0 <= k < index ==> a[k] >= 0)
  ensures index < 0 ==> index == -1 && (forall k :: 0 <= k < a.Length ==> a[k] >= 0)
{
  var i := 0;
  while i < a.Length
    invariant 0 <= i <= a.Length
    // invariant forall k :: 0 <= k < i ==> a[k] >= 0 (removed)
    decreases a.Length - i
  {
    if a[i] < 0 {
      return i;
    }
    i := i + 1;
  }
  return -1;
}

method Main() {
  var arr := new int;
  arr := -5; arr := 4; arr := -2;
  var idx := FindFirstNegative(arr);
  assert idx == 0; // Verification fails
}
</pre>
<div class="fail">
<b>Dafny output:</b><br>
Error: A postcondition might not hold on this return path.
</div>
<div class="contract-section">
  <b>Discussion:</b> Removal of the non-negativity invariant means the verifier cannot guarantee correctness and postcondition fails.
</div>
<hr>

<!-- ======================== -->
<h2>Task 3 – Factorial Calculation</h2>
<b>Verified Correct Code</b>
<pre>
function Fact(n: int): int
  requires n >= 0
  decreases n
{
  if n == 0 then 1 else n * Fact(n - 1)
}

method Factorial(n: int) returns (res: int)
  requires n >= 0
  ensures res == Fact(n)
{
  res := 1;
  var i := 0;
  while i < n
    invariant 0 <= i <= n
    invariant res == Fact(i)
    decreases n - i
  {
    i := i + 1;
    res := res * i;
  }
}
</pre>
<div class="contract-section">
  <b>Loop Invariant:</b>
  <ul>
    <li><code>res == Fact(i)</code>: Loop result matches mathematical factorial at every step.</li>
  </ul>
</div>
<b>Sample Output</b>
<div class="output">
Factorial of 5 is: 120<br>
Factorial of 0 is: 1
</div>
<b>Error Demonstration (Weakened Invariant)</b>
<pre>
function Fact(n: int): int
  requires n >= 0
{
  if n == 0 then 1 else n * Fact(n - 1)
}

method Factorial(n: int) returns (res: int)
  requires n >= 0
  ensures res == Fact(n)
{
  res := 1;
  var i := 0;
  while i < n
    invariant 0 <= i <= n
    invariant res >= 1
    decreases n - i
  {
    i := i + 1;
    res := res * i;
  }
}

method Main() {
  var f := Factorial(3);
  assert f == 6; // Verification fails
}
</pre>
<div class="fail">
<b>Dafny output:</b><br>
Error: A postcondition might not hold on this return path.
</div>
<div class="contract-section">
  <b>Discussion:</b> Using only <code>res >= 1</code> is too weak; the precise factorial invariant is required for successful verification.
</div>
<hr>

<!-- ======================== -->
<h2>Task 4 – Tribonacci Sequence</h2>
<b>Verified Correct Code</b>
<pre>
function Trib(n: int): int
  requires n >= 0
  decreases n
{
  if n == 0 then 0
  else if n == 1 then 1
  else if n == 2 then 1
  else Trib(n-1) + Trib(n-2) + Trib(n-3)
}

method Tribonacci(n: int) returns (result: int)
  requires n >= 0
  ensures result == Trib(n)
{
  if n == 0 { return 0; }
  if n == 1 { return 1; }
  if n == 2 { return 1; }

  var a := 0; // T(0)
  var b := 1; // T(1)
  var c := 1; // T(2)
  var i := 2;
  while i < n
    invariant 2 <= i <= n
    invariant a == Trib(i-2)
    invariant b == Trib(i-1)
    invariant c == Trib(i)
    decreases n - i
  {
    i := i + 1;
    var next := a + b + c;
    a := b;
    b := c;
    c := next;
  }
  return c;
}
</pre>
<div class="contract-section">
  <b>Loop Invariants:</b>
  <ul>
    <li><code>a == Trib(i-2)</code>, <code>b == Trib(i-1)</code>, <code>c == Trib(i)</code>: Recent values tracked for proof.</li>
  </ul>
</div>
<b>Sample Output</b>
<div class="output">
T(0) = 0<br>
T(1) = 1<br>
T(2) = 1<br>
T(3) = 2<br>
T(4) = 4<br>
T(5) = 7
</div>
<b>Error Demonstration (Omitted Sequence Invariants)</b>
<pre>
function Trib(n: int): int
  requires n >= 0
{
  if n == 0 then 0
  else if n == 1 then 1
  else if n == 2 then 1
  else Trib(n-1) + Trib(n-2) + Trib(n-3)
}

method Tribonacci(n: int) returns (result: int)
  requires n >= 0
  ensures result == Trib(n)
{
  if n == 0 { return 0; }
  if n == 1 { return 1; }
  if n == 2 { return 1; }

  var a := 0;
  var b := 1;
  var c := 1;
  var i := 2;
  while i < n
    invariant 2 <= i <= n
    // MISSING: a == Trib(i-2), b == Trib(i-1), c == Trib(i)
    decreases n - i
  {
    i := i + 1;
    var next := a + b + c;
    a := b;
    b := c;
    c := next;
  }
  return c;
}

method Main() {
  var t := Tribonacci(5);
  assert t == 7; // Verification fails
}
</pre>
<div class="fail">
<b>Dafny output:</b><br>
Error: A postcondition might not hold on this return path.
</div>
<div class="contract-section">
  <b>Discussion:</b> Omitting the key invariants means automatic verification cannot confirm any result matches the recursive definition.
</div>
<hr>

</body>
</html>
